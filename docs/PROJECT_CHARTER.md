# ChemVCS 项目章程 (Project Charter)

> v1.0 | 2026-02-09

---

## 1. 项目名称与定位

**ChemVCS — 计算材料的轻量级语义版本控制**

---

## 2. 战略背景

- 计算材料领域**无专用版本控制工具**，研究者依赖手动目录命名（`calc_v3_final_真final/`），版本混乱是 P0 级痛点。
- 现有方案两极分化：Git 不理解计算语义，AiiDA/FireWorks 需要 PostgreSQL/MongoDB 等重基础设施，不适合个人与小组。
- 科研复现性危机加剧，期刊和基金机构对数据溯源要求日趋严格，市场窗口明确。

---

## 3. 问题陈述

计算材料从业者在超算上反复调参、提交任务，但缺乏对 VASP/QE 等输入输出文件的版本追踪手段。参数修改无记录导致结果不可复现，学生毕业导致项目断层，论文审稿时无法回溯精确参数——而现有工具要么太通用（Git），要么太重（AiiDA），留下了"轻量 + 材料语义感知 + HPC 原生"的空白。

---

## 4. 目标（SMART）

| # | 目标 | 量化指标 | 截止日 |
|---|------|----------|--------|
| G1 | 交付核心 CLI 可用版本 | `init/add/commit/log/diff` 5 条命令通过集成测试 | 2026-03-09 |
| G2 | 实现 VASP 语义 diff | INCAR/POSCAR/KPOINTS 语义解析覆盖率 ≥90% | 2026-03-23 |
| G3 | HPC 调度集成上线 | 支持 SLURM + PBS，提交→监控端到端成功率 ≥95% | 2026-05-04 |
| G4 | 获得早期用户验证 | ≥3 个课题组试用，NPS ≥40 | 2026-05-18 |
| G5 | 发布 PyPI + conda-forge | 首月安装量 ≥200 | 2026-05-25 |

---

## 5. 范围

**In-scope：**

1. 类 Git 语义的 CLI（init / add / commit / log / diff / branch）
2. VASP 文件语义解析（INCAR、POSCAR、KPOINTS、OUTCAR 摘要）
3. 大文件分层策略：输出文件（WAVECAR/CHGCAR）采用 content-addressable 去重 + 可选外部存储引用（类 Git-LFS）
4. 赝势文件仅记录**哈希 + 路径引用**，不纳入版本库（规避许可风险）
5. SLURM / PBS 调度集成（submit / monitor）

**Out-of-scope：**

1. push / clone 远程同步（Phase 3，基于 SSH/rsync，本期仅设计协议）
2. Web UI / Dashboard（Phase 4，长期规划）
3. 赝势文件的内容分发与存储（仅引用，不复制）
4. 非 VASP 计算代码支持（QE/CP2K 延后至 Phase 4）
5. 自建对象存储或云服务后端

---

## 6. 关键干系人与职责

| 角色 | 人员 | 职责 |
|------|------|------|
| **Sponsor** | 项目发起人 | 确定产品方向、优先级决策、资源协调 |
| **PM / Tech Lead** | 核心开发者 | 架构设计、开发交付、社区运营 |
| **核心用户** | 博士生 / 博后 (Persona A/B) | 试用反馈、需求验证、复现场景提供 |
| **运维顾问** | 超算中心管理员 (Persona D) | HPC 兼容性验证、Lmod 集成测试、存储最佳实践建议 |

---

## 7. 关键假设

1. **用户**：目标用户具备基本 Linux CLI 能力，能接受 `pip install` 安装方式。
2. **用户**：研究者愿意在计算流程中额外执行 1-2 条 commit 命令以换取可溯源性。
3. **技术**：pymatgen 的 VASP I/O 模块足以覆盖主流输入输出文件解析，无需从零实现。
4. **技术**：SQLite 作为本地元数据存储在单用户场景下性能足够（<10k commits）。
5. **HPC 环境**：主流超算允许用户在登录节点执行 Python CLI 工具，且 `$HOME` 或 `$SCRATCH` 可读写。
6. **HPC 环境**：共享文件系统（Lustre/GPFS）支持 SQLite 的 WAL 模式或可退回至回滚日志模式。
7. **合规**：赝势文件受 VASP 许可协议约束，ChemVCS 仅存储哈希引用，不复制分发其内容。
8. **分发**：PyPI + conda-forge 双渠道覆盖 ≥90% 的计算材料 Python 用户。

---

## 8. 里程碑

| 时间 | 里程碑 | 可验收产出 |
|------|--------|------------|
| **T+4 周** | Core CLI Alpha | `chemvcs init/add/commit/log/diff` 可在本地运行，VASP 语义 diff 可演示 |
| **T+8 周** | HPC Beta | SLURM 提交→监控→结果自动摘要端到端流程通过；3 个课题组内测启动 |
| **T+12 周** | Public Release v0.1 | PyPI/conda-forge 发布；用户文档 + quickstart 完成；收集首批 NPS 反馈 |

---

## 9. 成功标准

| # | 指标 | 目标值 | 说明 |
|---|------|--------|------|
| S1 | **周活跃用户（WAU）** | ≥30（T+12 周） | 主指标，衡量真实使用粘性 |
| S2 | 7 日留存率 | ≥40% | 首次使用后一周内再次执行命令 |
| S3 | 复现成功率 | ≥95% | 执行 `chemvcs reproduce <version>` 后计算结果一致 |
| S4 | 迁移成本 | ≤15 分钟 | 将现有手动管理项目导入 ChemVCS 的平均耗时 |
| S5 | 安装到首次 commit 时间 | ≤5 分钟 | 衡量上手门槛 |
| S6 | 课题组采纳率 | ≥3 个课题组全员使用 | 验证团队级价值 |

---

## 10. 主要风险与缓解

| # | 风险 | 影响 | 缓解措施 |
|---|------|------|----------|
| R1 | **共享文件系统并发冲突** | 高 | 元数据操作加文件锁（`fcntl.flock`）；写操作序列化；冲突时给出明确提示 |
| R2 | **SQLite 在网络文件系统上锁失效** | 高 | 检测 Lustre/NFS 并自动退回 rollback journal 模式；提供 `--local-db` 选项将 DB 放在本地磁盘 |
| R3 | **VASP 赝势许可合规风险** | 中 | 仅存储 SHA-256 哈希 + 路径引用，永不复制文件内容；文档明确声明 |
| R4 | **大文件（WAVECAR ≥10 GB）拖慢操作** | 中 | 默认排除 WAVECAR/CHGCAR；可选纳入时仅存哈希指纹，不做全量 diff |
| R5 | **用户习惯阻力——"多一步操作"** | 高 | 提供 `auto-commit` 钩子（检测 sbatch 自动 commit）；渐进式引导 |
| R6 | **HPC 调度器多样性** | 中 | 抽象 `Scheduler` 接口 + 插件机制；MVP 仅支持 SLURM + PBS |
| R7 | **pymatgen 版本不兼容或 API 变更** | 低 | 锁定最低兼容版本；语义解析层做适配抽象 |
| R8 | **单人维护可持续性风险** | 高 | 早期聚焦最小可用范围；撰写 JOSS 软件论文争取学术引用驱动社区贡献 |

---

*批准后即启动 Phase 1 开发。*
