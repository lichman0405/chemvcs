# ChemVCS 项目发现文档

> 日期: 2026-02-09  
> 阶段: 项目初期探索 (Discovery Phase)

---

## 1. 问题域分析

### 1.1 计算材料项目是否有版本管理？

**简短回答：没有真正的"版本管理"，只有工作流管理和数据溯源（provenance）。**

计算材料学领域目前的工具生态可以分为以下几层：

| 层级 | 工具 | Stars | 功能 | 局限 |
|------|------|-------|------|------|
| **材料分析库** | pymatgen, ASE | 1.8k, ~600 | 结构操作、输入输出、计算器接口 | 不涉及项目管理或版本控制 |
| **工作流引擎** | atomate2, FireWorks | 279, 420 | 定义和执行计算工作流 | 重度依赖 MongoDB/基础设施 |
| **数据溯源** | AiiDA | 536 | 完整的 provenance graph，HPC 调度 | 需要 PostgreSQL + RabbitMQ，学习曲线陡峭 |
| **数据管道** | Maggma | 43 | ETL 式数据加工管道 | 仅处理数据流，不涉及版本 |
| **数据管理** | signac | 138 | 基于文件系统的数据空间组织 | 无 HPC 调度，无语义理解 |
| **远程执行** | jobflow-remote | 36 | 远程运行 jobflow 工作流 | 仅为 jobflow 的远程执行层 |

**关键发现：**
- 现有工具侧重于**工作流编排**（如何自动跑一系列计算）和**数据溯源**（追踪输入→输出关系）。
- **没有任何工具提供类似 Git 的版本控制语义**——即：对一个计算项目进行 commit、branch、diff、rollback 操作。
- 研究人员普遍依赖**手动目录命名**（如 `calc_v1/`, `calc_v2_more_kpoints/`）来"管理版本"。
- 即使用了 Git，Git 也不理解计算文件的语义（POSCAR、INCAR、OUTCAR 等）——它只是逐行比较文本。

### 1.2 计算材料从业者如何使用超算？常见痛点

#### 典型工作流程：

```
本地开发 → SSH到超算 → 准备输入文件 → sbatch提交 → 等待排队 → 
检查输出 → 调参 → 重新提交 → ... → scp回本地 → 分析
```

#### 核心痛点（按严重程度排序）：

**🔴 P0 - 版本混乱（Version Chaos）**
- 参数调了几十次，不记得哪个版本对应哪组参数
- "上周跑出来的好结果用的什么参数？" → 找不到了
- 多个超算节点上散落着不同版本的输入文件
- INCAR、KPOINTS 微调后忘记记录，结果无法复现

**🔴 P0 - 复现困难（Reproducibility Crisis）**
- 论文 reviewer 要求重新跑某个计算 → 找不到当时的参数
- 同组同事用"一样的"参数跑不出一样的结果 → 某个环境变量不同
- 软件版本（VASP 5.4.4 vs 6.3）影响结果但未被记录
- 赝势文件版本不同导致结果差异

**🟡 P1 - 超算调度痛苦（HPC Scheduling Pain）**
- 手写 SLURM/PBS 脚本，容易出错
- 批量提交任务需要自己写循环脚本
- 任务失败后需要手动检查原因、修复、重新提交
- 不同超算系统的脚本格式不同，需要维护多套模板

**🟡 P1 - 协作割裂（Collaboration Fragmentation）**
- 无法方便地分享"这个计算项目"给同事
- 代码（脚本）用 Git 管理，但计算数据不在 repo 里
- 没有标准方式记录"为什么做了这个决定"

**🟢 P2 - 数据管理混乱（Data Management）**
- 输出文件动辄几十 GB，不知道保留哪些
- 无法快速查询"所有使用 PBE+U 泛函的计算结果"
- 数据在本地、超算、备份盘之间不一致

### 1.3 现有解决方案的差距分析

```
                    轻量级                          重量级
                    ↓                               ↓
    Git     signac  ←——— 差距 ———→  FireWorks  AiiDA
    |         |                        |          |
    纯文本    文件系统管理              MongoDB    PostgreSQL
    无语义    无HPC调度                工作流编排   完整provenance
    免费      简单                    复杂        非常复杂
```

**核心差距（这就是 ChemVCS 的机会）：**

1. **Git 太通用**：不理解 INCAR/POSCAR/KPOINTS 的语义，不能做智能 diff
2. **AiiDA/FireWorks 太重**：需要数据库、消息队列、复杂配置，不适合个人/小组使用
3. **signac 太简单**：仅做数据组织，不涉及版本控制和 HPC 调度
4. **没有"中间地带"**：一个既理解计算材料语义、又足够轻量、能在 HPC 上直接用的工具

---

## 2. 用户画像 (Personas)

### 👩‍🔬 Persona A：李明（Ming） - 博士研究生

| 属性 | 描述 |
|------|------|
| **背景** | 材料科学博士二年级，导师课题组约15人 |
| **技能** | 会基本 Linux 命令，会写简单 Python 脚本，知道 Git 但不熟练 |
| **常用工具** | VASP, VASPKIT, pymatgen, Origin/matplotlib |
| **超算使用** | 学校超算集群（SLURM），每月约200个核时 |
| **日常** | 每天 SSH 到超算检查任务→调参→重新提交，大量时间花在等待和手动操作上 |

**痛点故事：**
> "我在做锂电池正极材料的掺杂研究。上周导师问我 Co 掺杂 3% 那组的能量是多少，我翻了半天超算上的目录才找到。目录叫 `LCO_Co3_v3_final_真final/`。我甚至不确定 INCAR 是第几版的..."

**核心需求：**
- 😫 能帮我自动记录每次计算的参数和结果
- 😫 能快速找到某组特定条件的计算
- 😫 能在写论文时回溯到当时的精确参数
- 🙏 最好不要太复杂，我的组里没有 IT 支持

**对 ChemVCS 的期望：**
```
chemvcs init                    # 初始化项目
chemvcs commit -m "PBE+U, U=3.5eV, kpoints 4x4x4"  # 记录一个版本
chemvcs log                     # 看历史
chemvcs diff v1 v3              # 比对两个版本的参数差异（语义级别）
chemvcs submit --slurm          # 直接在超算提交
```

---

### 👨‍🔬 Persona B：王博（Bo） - 博后 / 助理研究员

| 属性 | 描述 |
|------|------|
| **背景** | 计算化学博士后，主导一个高通量筛选项目 |
| **技能** | 熟练 Python/Linux，了解 Docker，Git 熟练用户 |
| **常用工具** | VASP, Quantum ESPRESSO, ASE, pymatgen, atomate2 |
| **超算使用** | 国家超算中心 + AWS HPC，每月数万核时 |
| **日常** | 批量生成输入→批量提交→监控→后处理→数据入库 |

**痛点故事：**
> "我同时在筛选2000个候选材料。atomate2 帮我自动化了计算流程，但当某个批次出了问题，我想回滚到某个中间状态或者比较不同参数集的效果时，根本没办法。所有数据都在 MongoDB 里，但我想要的是'这20个材料在参数集A和参数集B下的结果对比'。"

**核心需求：**
- 😫 对大批量计算的参数进行分支管理（branching）
- 😫 在不同超算之间迁移计算项目
- 😫 和组员协作时能 share 标准化的计算配置
- 🙏 能和现有工具（atomate2, pymatgen）集成

**对 ChemVCS 的期望：**
```
chemvcs branch pbe-u3.5         # 创建参数分支
chemvcs branch pbe-u4.0
chemvcs compare pbe-u3.5 pbe-u4.0  # 比较两组参数的结果差异
chemvcs push --remote national-hpc  # 同步到国家超算
chemvcs export --format atomate2    # 导出为 atomate2 兼容格式
```

---

### 👩‍💻 Persona C：张芳（Fang） - 课题组长 / PI

| 属性 | 描述 |
|------|------|
| **背景** | 副教授，带8名研究生和3名博后 |
| **技能** | 早年做过计算，现在主要做管理和学术指导 |
| **常用工具** | 不直接使用计算工具，通过学生的汇报了解进展 |
| **超算使用** | 课题组共享超算账号，靠学生手动分配 |
| **日常** | 审查学生的计算结果、写基金、写论文 |

**痛点故事：**
> "毕业的学生把数据留在超算上就走了，新来的学生完全无法理解前任的目录结构和命名规则。每年因为这个问题至少浪费一个月的时间。更糟糕的是，发表了的论文有时候会收到质疑，需要重新验证计算结果，但用的什么参数、什么版本的赝势根本找不到了。"

**核心需求：**
- 😫 课题组的计算项目需要标准化管理
- 😫 学生毕业时能完整交接计算项目
- 😫 论文发表后能保证数据可溯源
- 🙏 要简单到我能要求所有学生使用

**对 ChemVCS 的期望：**
```
chemvcs clone student://zhangsan/LCO-project  # 接手学生项目
chemvcs audit                    # 查看项目完整历史
chemvcs reproduce v2.3           # 完全复现某个历史版本的计算
chemvcs archive --for-publication  # 为发表准备归档包
```

---

### 🧑‍💻 Persona D：陈工（Chen） - 超算中心运维 / 平台工程师

| 属性 | 描述 |
|------|------|
| **背景** | 某高校超算中心系统管理员 |
| **技能** | 精通 Linux、SLURM、容器化、存储系统 |
| **常用工具** | Ansible, Singularity/Apptainer, Lmod, SLURM |
| **日常** | 维护超算集群、安装软件、处理用户问题、管理存储 |

**痛点故事：**
> "用户的 home 目录经常爆满，绝大部分是计算输出的临时文件。他们不知道哪些能删哪些不能删。还有人经常把赝势文件拷贝了几十份分散在不同目录里。如果有个工具能帮用户自动管理计算项目的数据，我们的存储压力会小很多。"

**核心需求：**
- 😫 减少用户的存储浪费
- 😫 标准化用户的目录结构
- 🙏 工具不要引入额外的服务依赖（不要数据库！）
- 🙏 能作为模块加载 (`module load chemvcs`)

**对 ChemVCS 的期望：**
```
# 纯 CLI，无需额外服务
# 可以通过 Lmod/module 加载
# 数据存储在本地文件系统（或共享文件系统如 Lustre）
# 提供存储优化（去重、压缩、清理策略）
```

---

## 3. 竞品对标矩阵

| 特性 | Git | AiiDA | FireWorks | signac | atomate2 | **ChemVCS (目标)** |
|------|-----|-------|-----------|--------|----------|--------------------|
| 版本控制语义 | ✅ 通用 | ❌ | ❌ | ❌ | ❌ | ✅ **专用** |
| 计算材料语义理解 | ❌ | ✅ 插件 | ❌ | ❌ | ✅ | ✅ **内置** |
| 数据溯源 | ❌ | ✅ | 部分 | 部分 | 部分 | ✅ |
| HPC 调度集成 | ❌ | ✅ | ✅ | ❌ | ✅ | ✅ **轻量** |
| 安装复杂度 | 低 | **高** | **高** | 低 | 中 | **低** |
| 外部依赖 | 无 | PG+RabbitMQ | MongoDB | 无 | MongoDB | **无** |
| 学习曲线 | 中 | **陡** | **陡** | 低 | 中 | **低** |
| 协作支持 | ✅ | ✅ | ✅ | ❌ | ❌ | ✅ |
| 适合场景 | 代码 | 大团队 | 大团队 | 小数据 | 高通量 | **个人→团队** |

---

## 4. 产品定位与价值主张

### 一句话定位

> **ChemVCS = Git for Computational Materials Science**  
> 一个专为计算材料学设计的轻量级版本控制系统，理解你的 VASP/QE 输入输出，跑在超算上不需要数据库。

### 核心价值主张

1. **像 Git 一样简单** — `init / commit / log / diff / branch` 直觉式 CLI
2. **理解材料科学** — 智能识别 INCAR/POSCAR/KPOINTS 变更，提供语义级 diff
3. **HPC 原生** — 直接与 SLURM/PBS 集成，不需要外部数据库或服务
4. **零基础设施** — 纯文件系统存储，`pip install chemvcs` 即可使用
5. **可溯源可复现** — 每次计算的完整环境快照（参数 + 软件版本 + 赝势哈希）

### 与现有工具的关系

```
ChemVCS 不是要替代 AiiDA 或 atomate2，而是填补"空白地带"：

  个人研究者 ←——— ChemVCS ———→ 小型课题组
                     ↑
                     | 可选集成
                     ↓
              AiiDA / atomate2 / FireWorks
              （大团队、高通量筛选场景）
```

---

## 5. 建议的 MVP 路线图

### Phase 1：核心版本控制（1-2个月）
- [ ] `chemvcs init` — 初始化计算项目
- [ ] `chemvcs add / commit` — 追踪输入文件变更
- [ ] `chemvcs log / status` — 查看历史和当前状态
- [ ] `chemvcs diff` — 语义级参数比较（INCAR key-value diff, POSCAR 结构差异）
- [ ] 支持 VASP 文件格式的语义解析

### Phase 2：HPC 集成（1-2个月）
- [ ] `chemvcs submit` — 生成并提交 SLURM/PBS 脚本
- [ ] `chemvcs monitor` — 监控任务状态
- [ ] 自动记录计算环境（software module, 编译器版本等）
- [ ] 输出文件自动摘要（收敛了吗？能量是多少？）

### Phase 3：协作与复现（2-3个月）
- [ ] `chemvcs clone / push / pull` — 项目同步（基于 SSH/rsync）
- [ ] `chemvcs reproduce` — 完整复现某个历史计算
- [ ] `chemvcs export` — 导出为标准化归档包（含元数据）
- [ ] 与 pymatgen 集成（读取/写入 Structure 对象）

### Phase 4：扩展（长期）
- [ ] 支持更多计算代码（Quantum ESPRESSO, CP2K, ORCA 等）
- [ ] Web UI / Dashboard（可选）
- [ ] 与 Materials Cloud / NOMAD 等数据库对接
- [ ] AI 辅助参数建议

---

## 6. 技术选型建议

| 组件 | 选择 | 理由 |
|------|------|------|
| 语言 | Python | 计算材料社区标准语言，pymatgen/ASE 生态 |
| 存储 | 文件系统 (JSON/SQLite) | 零依赖，HPC 友好 |
| CLI 框架 | Click / Typer | 成熟的 Python CLI 框架 |
| 文件解析 | pymatgen (VASP), ASE (通用) | 不重复造轮子 |
| 哈希/追踪 | 类 Git 的 content-addressable storage | 去重、完整性校验 |
| 分发 | PyPI + conda-forge | 计算材料社区标准安装渠道 |

---

## 7. 风险与挑战

| 风险 | 影响 | 缓解策略 |
|------|------|----------|
| 用户习惯难改变 | 高 | 提供迁移工具，渐进式采用 |
| 大文件处理 | 中 | 类 git-lfs 的大文件策略 |
| HPC 环境多样性 | 中 | 抽象调度层，支持插件 |
| 与 AiiDA 等竞争 | 低 | 差异化定位（轻量 vs 重量） |
| 维护人力不足 | 高 | 开源社区化运营 |

---

## 8. 成功指标

| 指标 | 6个月目标 | 12个月目标 |
|------|-----------|------------|
| GitHub Stars | 100 | 500 |
| PyPI 月下载量 | 500 | 5,000 |
| 活跃用户（月） | 50 | 300 |
| 支持的计算代码 | VASP | VASP + QE + CP2K |
| 论文引用 | 0 | 提交1篇软件论文 |

---

*本文档为项目初期探索成果，将随着用户反馈和技术验证持续更新。*
